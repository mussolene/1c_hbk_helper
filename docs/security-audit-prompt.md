# Промпт: план аудита безопасности проекта 1C Help MCP

Составь детальный план аудита безопасности для проекта onec_help (1C Help MCP).

## Контекст проекта

- **Назначение:** распаковка справки 1С (.hbk), конвертация в Markdown, индексация в Qdrant, MCP-сервер для поиска по справке, интеграция с BSL LS.
- **Стек:** Python 3.14, Flask (serve), FastMCP (MCP по HTTP), Qdrant, sentence-transformers / внешние embedding API.
- **Архитектура:** Docker Compose (qdrant, mcp). BSL bridge — отдельно `make bsl-start`. Cron для ingest, опциональный watchdog.
- **Конфиденциальные данные:** текст справки и поисковые запросы идут на embedding API; память (topic_path, save_snippet) в JSONL и Qdrant; сниппеты и код 1С в SNIPPETS_DIR.

## NDA и конфиденциальность

- Проект может использоваться с **конфиденциальным кодом 1С** и данными под NDA.
- **Embedding API:** текст справки и запросы уходят на внешний сервис (LM Studio, OpenAI и т.п.). При NDA требуется on-prem (EMBEDDING_API_URL на внутренний хост).
- **Memory, сниппеты:** хранятся на диске и в Qdrant; при NDA — защищённые пути, политика хранения.
- **Аудит:** исполнитель аудита может подпадать под NDA заказчика. План должен предусматривать:
  - обработку отчёта как конфиденциального;
  - передачу результатов только уполномоченным лицам;
  - хранение находок в защищённом виде, без публикации до снятия ограничений.

## Требования к плану

1. **Структура:** фазы (подготовка, анализ, тестирование, отчёт), задачи в каждой фазе, артефакты.
2. **Области проверки:**
   - веб (Flask serve): аутентификация, авторизация, CORS, инъекции, path traversal;
   - MCP-сервер: аутентификация, rate limiting, валидация входных данных;
   - инжекция: HTML/XML парсинг, SQLite ingest cache, Qdrant;
   - секреты: env vars, токены, пути, логи;
   - зависимости: Python packages, Docker образы, GitHub Actions;
   - внешние сервисы: embedding API, FastCode.im, v8-code-style, GitHub;
   - Docker: права, volume, сеть, базовые образы.
3. **NDA в процессе аудита:** чеклист действий при работе с конфиденциальным кодом/данными; шаблон соглашения о неразглашении для исполнителя при необходимости.
4. **Методы:** checklist, SAST/DAST (если применимо), dependency scan, ручной код-ревью по критическим участкам.
5. **Приоритеты:** критичные риски отдельно, затем высокие и средние.
6. **Артефакты:** формат отчёта, шаблон для находок (ID, описание, severity, remediation), правила хранения и распространения при NDA.

## Ожидаемый результат

Markdown-документ с планом аудита, готовый к передаче исполнителю или встраиванию в backlog, с учётом требований NDA и конфиденциальности.
