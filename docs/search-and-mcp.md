# Поиск по справке 1С и MCP

## Почему «Topic not found» и темы вроде МенеджерКриптографии не находились

1. **Контент не на диске после ingest**  
   При `ingest` справка распаковывается во **временный** каталог, конвертируется в Markdown, индексируется в Qdrant, после чего временные файлы **удаляются**. MCP запускается с `HELP_PATH=/data`, но в `/data` ничего не записывается. Поэтому `get_1c_help_topic(path)` искал файл на диске и не находил его.

   **Исправление:** топик по пути теперь подгружается из **payload в Qdrant**, если файл по этому пути на диске отсутствует.

2. **Только семантический поиск**  
   Векторный поиск по эмбеддингам может «промахнуться» по точным терминам (например «МенеджерКриптографии», «интерактивный режим»), особенно если термин не в первых 8000 символах страницы (используемых для эмбеддинга).

   **Исправление:** добавлен **ключевой поиск** (`search_1c_help_keyword`) — по вхождению подстроки в заголовок и текст. Для точных имён и параметров запуска его нужно вызывать первым.

3. **get_1c_function_info**  
   Раньше использовал только семантический поиск и совпадение по заголовку. Для имён вроде «МенеджерКриптографии» теперь сначала выполняется ключевой поиск, затем при необходимости семантический.

## Оптимизация результата поиска

- Для **точных имён** (функции, параметры командной строки, МенеджерКриптографии и т.д.) — используйте **search_1c_help_keyword**.
- Для **общих вопросов** («как объединить периоды», «синтаксис запроса») — **search_1c_help**.
- После поиска получайте полный текст по **path** из выдачи через **get_1c_help_topic**.
- Для просмотра списка тем (например, все параметры запуска) — **list_1c_help_titles** с `path_prefix="zif"`.

В payload индекса теперь сохраняется до 50 000 символов текста темы (ранее 12 000), чтобы длинные статьи полностью подгружались из Qdrant при отсутствии файла на диске.
